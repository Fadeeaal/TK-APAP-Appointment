<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <object th:include="~{fragments/common :: js}" th:remove="tag"></object>
    <object th:include="~{fragments/common :: css}" th:remove="tag"></object>
    <title>Update Doctor</title>
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <script th:src="@{/js/bootstrap.bundle.min.js}"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

    <style>
        .form-container {
            width: 60rem;
            margin: auto;
        }

        .add-button {
            margin-bottom: 20px;
        }

        .schedule-list li {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .schedule-list .remove-btn {
            background-color: transparent;
            border: none;
            color: red;
            cursor: pointer;
        }

        .schedule-list .remove-btn i {
            font-size: 1.2rem;
        }

        .btn-primary {
            background-color: #007bff;
        }

        .btn-cancel {
            background-color: #f44336;
        }
    </style>
</head>

<body>
    <!-- Navbar -->
    <nav th:replace="~{fragments/navbar :: navbar}"></nav>

    <div class="container">
        <div class="text-center my-4">
            <h2>Update Doctor</h2>
        </div>

        <div class="row justify-content-center">
            <div class="card form-container">
                <div class="card-body">
                    <form th:action="@{/doctor/update}" th:object="${doctorDTO}" method="POST">
                        <!-- Hidden Field for ID -->
                        <input type="hidden" th:field="*{id}" />

                        <!-- Nama dan Email Field -->
                        <div class="row my-3">
                            <div class="col-md-6">
                                <label for="nama-doctor" class="fw-bold">Name</label>
                                <input class="form-control" type="text" id="nama-doctor" th:field="*{name}" required />
                            </div>
                            <div class="col-md-6">
                                <label for="email" class="fw-bold">Email</label>
                                <input class="form-control" type="email" id="email" th:field="*{email}" required />
                            </div>
                        </div>

                        <!-- Gender dan Specialist Field -->
                        <div class="row my-3">
                            <div class="col-md-6">
                                <label for="gender" class="fw-bold">Gender</label>
                                <div>
                                    <input type="radio" id="male" th:field="*{gender}" value="false">
                                    <label for="male">Male</label>
                                    <input type="radio" id="female" th:field="*{gender}" value="true">
                                    <label for="female">Female</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label for="specialist" class="fw-bold">Specialization</label>
                                <select class="form-select" id="specialist" th:field="*{specialist}" required>
                                    <option value="0">Dokter Umum</option>
                                    <option value="1">Dokter Gigi</option>
                                    <option value="2">Spesialis Anak</option>
                                    <option value="3">Bedah</option>
                                    <option value="4">Bedah Plastik</option>
                                    <option value="5">Jantung dan Pembuluh Darah</option>
                                    <option value="6">Kulit dan Kelamin</option>
                                    <option value="7">Mata</option>
                                    <option value="15">Obstetri dan Ginekologi</option>
                                    <option value="8">Penyakit Dalam</option>
                                    <option value="9">Paru</option>
                                    <option value="10">THT</option>
                                    <option value="16">Radiologi</option>
                                    <option value="11">Kesehatan Jiwa</option>
                                    <option value="12">Anestesi</option>
                                    <option value="13">Neurologi</option>
                                    <option value="14">Urologi</option>
                                </select>
                            </div>
                        </div>

                        <!-- Years of Experience Field -->
                        <div class="row my-3">
                            <div class="col-md-6">
                                <label for="yearsOfExperience" class="fw-bold">Years of Experience</label>
                                <input class="form-control" type="number" id="yearsOfExperience"
                                    th:field="*{yearsOfExperience}" min="0" required />
                            </div>
                        </div>

                        <!-- Fee Field -->
                        <div class="row my-3">
                            <div class="col-md-6">
                                <label for="fee" class="fw-bold">Fee</label>
                                <input class="form-control" type="number" id="fee" th:field="*{fee}" min="0" required />
                            </div>
                        </div>

                        <!-- Schedule Field -->
                        <div class="row my-3">
                            <div class="col-md-6">
                                <label for="schedule-select" class="fw-bold">Schedule</label>
                                <div class="input-group">
                                    <select class="form-select" id="schedule-select">
                                        <option value="0">Senin</option>
                                        <option value="1">Selasa</option>
                                        <option value="2">Rabu</option>
                                        <option value="3">Kamis</option>
                                        <option value="4">Jumat</option>
                                        <option value="5">Sabtu</option>
                                        <option value="6">Minggu</option>
                                    </select>
                                    <button type="button" class="btn btn-primary add-button" id="add-schedule">Add
                                        Schedule</button>
                                </div>
                            </div>
                        </div>

                        <!-- Selected Schedules -->
                        <div class="row my-3">
                            <div class="col-md-6">
                                <label class="fw-bold">Selected Schedules</label>
                                <ul id="schedule-list" class="schedule-list list-group">
                                    <!-- Prepopulate Schedules -->
                                    <li th:each="schedule : ${doctorDTO.schedules}"
                                        th:text="${schedule == 0 ? 'Senin' : 
                                                 schedule == 1 ? 'Selasa' : 
                                                 schedule == 2 ? 'Rabu' : 
                                                 schedule == 3 ? 'Kamis' : 
                                                 schedule == 4 ? 'Jumat' : 
                                                 schedule == 5 ? 'Sabtu' : 
                                                 'Minggu'}"
                                        data-value="${schedule}">
                                        <!-- Jadwal sudah ada akan dihapus jika perlu -->
                                        <button type="button" class="remove-btn" th:data-value="${schedule}">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </li>
                                </ul>
                            </div>
                        </div>

                        <!-- Input hidden untuk menampung schedules sebagai array integer -->
                        <input type="hidden" name="schedules" th:field="*{schedules}" id="schedules-hidden" />

                        <!-- Submit and Cancel Button -->
                        <div class="row text-center m-3">
                            <div class="col-md-6">
                                <button type="submit" class="btn btn-primary w-100">Submit</button>
                            </div>
                            <div class="col-md-6">
                                <a href="/" class="btn btn-cancel w-100">Cancel</a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function () {
            let selectedSchedules = [];
        
            // Prepopulate schedules (Existing schedules)
            $('#schedule-list li').each(function () {
                const existingValue = $(this).attr('data-value');
                if (existingValue && !isNaN(parseInt(existingValue, 10))) {
                    selectedSchedules.push(parseInt(existingValue, 10));
                }
            });
        
            // Update the hidden input with the initial selected schedules
            $('#schedules-hidden').val(selectedSchedules.join(","));
        
            // Add schedule to list when user clicks "Add Schedule"
            $('#add-schedule').click(function () {
                const selectedValue = $('#schedule-select').val();
                const selectedText = $('#schedule-select option:selected').text();
        
                // Ensure selected value is valid and not NaN
                if (selectedValue !== null && selectedValue !== undefined && selectedValue !== '' && !isNaN(parseInt(selectedValue, 10))) {
                    const scheduleIntValue = parseInt(selectedValue, 10);
        
                    // Check if the schedule has already been added
                    if (!selectedSchedules.includes(scheduleIntValue)) {
                        selectedSchedules.push(scheduleIntValue);
        
                        // Add the selected schedule to the list display
                        $('#schedule-list').append(`
                            <li class="list-group-item" data-value="${scheduleIntValue}">
                                ${selectedText}
                                <button type="button" class="remove-btn btn btn-link text-danger" data-value="${scheduleIntValue}">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </li>
                        `);
        
                        // Update hidden input with the selected schedules
                        $('#schedules-hidden').val(selectedSchedules.join(","));
                    } else {
                        alert("This schedule is already added.");
                    }
                } else {
                    alert("Please select a valid schedule.");
                }
            });
        
            // Remove schedule from list when user clicks the trash icon
            $('#schedule-list').on('click', '.remove-btn', function () {
                const valueToRemove = $(this).data('value');
        
                // Remove from the array of selected schedules
                selectedSchedules = selectedSchedules.filter(item => item !== parseInt(valueToRemove, 10));
        
                // Remove the schedule from the display
                $(this).closest('li').remove();
        
                // Update hidden input with the updated list of schedules
                $('#schedules-hidden').val(selectedSchedules.join(","));
            });
        });        
    </script>
</body>
</html>
